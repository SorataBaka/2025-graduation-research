version: "3.8"

services:
  # PostgreSQL for Label Studio
  db:
    image: postgres:15
    restart: unless-stopped
    environment:
      POSTGRES_DB: labelstudio
      POSTGRES_USER: lsuser
      POSTGRES_PASSWORD: lspassword
    volumes:
      - pgdata:/var/lib/postgresql/data

  # Label Studio
  labelstudio:
    image: heartexlabs/label-studio:latest
    depends_on:
      - db
    ports:
      - "8080:8080"
    environment:
      - POSTGRE_NAME=labelstudio
      - POSTGRE_USER=lsuser
      - POSTGRE_PASSWORD=lspassword
      - POSTGRE_PORT=5432
      - POSTGRE_HOST=db
      - LABEL_STUDIO_USERNAME=admin
      - LABEL_STUDIO_PASSWORD=admin123
    volumes:
      - labelstudio_data:/label-studio/data
    command: >
      label-studio start
      --username admin
      --password admin123
      --host 0.0.0.0
      --port 8080
      --init
    restart: unless-stopped

  # MongoDB for Custom Stats Tracking
  mongodb:
    image: mongo:latest
    restart: always
    ports:
      - 27017:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: mongoroot
      MONGO_INITDB_ROOT_PASSWORD: mongopassword
    volumes:
      - mongodb_data:/data/db

volumes:
  pgdata:
  labelstudio_data:
  mongodb_data:
